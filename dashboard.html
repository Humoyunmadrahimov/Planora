<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanPro - Sizning online yordamchinggiz</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6B4EFF">
    <link rel="icon" type="image/png" href="assets/icon-01.png">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=1.3">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Lucide Icons (Since we don't have npm/bundler, using CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Guaranteed Fallback Toggle
        function safeToggleSidebar() {
            var sidebar = document.querySelector('.sidebar');
            var overlay = document.querySelector('.sidebar-overlay');

            if (sidebar) {
                // Force Toggle
                if (sidebar.classList.contains('mobile-open') || sidebar.style.transform === 'translateX(0px)') {
                    sidebar.classList.remove('mobile-open');
                    sidebar.style.transform = '';
                    if (overlay) overlay.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    sidebar.classList.add('mobile-open');
                    sidebar.style.transform = 'translateX(0)';
                    if (overlay) overlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            } else {
                console.error('Sidebar not found!');
            }
        }
    </script>
</head>

<body>
    <div class="sidebar-overlay" onclick="safeToggleSidebar()"></div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo" onclick="switchTab('dashboard', document.querySelector('.nav-item'))"
                style="cursor: pointer;">
                <div id="sidebar-logo" class="plan-pro-logo"></div>
            </div>

            <!-- Removed Create New Pitch Button -->

            <nav class="nav-menu">
                <a href="#" id="nav-dashboard" class="nav-item active" onclick="switchTab('dashboard', this)">
                    <i data-lucide="layout-grid"></i>
                    <span>Bosh sahifa</span>
                </a>
                <a href="#" id="nav-tasks" class="nav-item" onclick="switchTab('tasks', this)">
                    <i data-lucide="check-square"></i>
                    <span>Vazifalar</span>
                </a>
                <a href="#" id="nav-calendar" class="nav-item" onclick="switchTab('calendar', this)">
                    <i data-lucide="calendar"></i>
                    <span>Kalendar</span>
                </a>
                <a href="#" id="nav-finance" class="nav-item" onclick="switchTab('finance', this)">
                    <i data-lucide="dollar-sign"></i>
                    <span>Moliya</span>
                </a>
                <a href="#" id="nav-notes" class="nav-item" onclick="switchTab('notes', this)">
                    <i data-lucide="edit-3"></i>
                    <span>Qaydlar</span>
                </a>
                <a href="#" id="admin-nav-item" class="nav-item admin-only" style="display: none;"
                    onclick="switchTab('admin', this)">
                    <i data-lucide="shield-check"></i>
                    <span>Admin Panel</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-bar">
                <button id="mobile-menu-toggle" class="mobile-menu-btn" onclick="safeToggleSidebar()">
                    <i data-lucide="menu"></i>
                </button>
                <div class="page-title">
                    <div class="title-group">
                        <h1 id="page-heading">Bosh sahifa</h1>
                    </div>
                </div>
                <div class="top-bar-actions">
                    <div id="live-clock" class="top-clock">00:00</div>
                    <div class="action-wrapper">
                        <button class="icon-btn" onclick="toggleMessages()">
                            <i data-lucide="mail"></i>
                            <span id="msg-badge" class="badge-count" style="display: none;">0</span>
                        </button>
                        <div id="messages-dropdown" class="action-dropdown">
                            <div class="dropdown-header">
                                <span>Xabarlar</span>
                                <span onclick="markAllMessagesRead(); event.stopPropagation();"
                                    style="font-size: 0.8rem; color: var(--primary); cursor: pointer; padding: 4px 8px; border-radius: 4px; background: rgba(59, 130, 246, 0.05);">Hammasini
                                    o'qish</span>
                            </div>
                            <div id="messages-list" class="dropdown-list">
                                <!-- Messages will be injected here -->
                            </div>
                        </div>
                    </div>

                    <div class="action-wrapper">
                        <button class="icon-btn" onclick="toggleNotifications()">
                            <i data-lucide="bell"></i>
                            <span id="notif-badge" class="badge-count" style="display: none;">0</span>
                        </button>
                        <div id="notifications-dropdown" class="action-dropdown">
                            <div class="dropdown-header">
                                <span>Bildirishnomalar</span>
                                <span onclick="clearNotifications(); event.stopPropagation();"
                                    style="font-size: 0.8rem; color: var(--primary); cursor: pointer; padding: 4px 8px; border-radius: 4px; background: rgba(59, 130, 246, 0.05);">Tozalash</span>
                            </div>
                            <div id="notifications-list" class="dropdown-list">
                                <!-- Notifications will be injected here -->
                            </div>
                        </div>
                    </div>
                    <div class="user-profile" onclick="toggleProfileMenu()">
                        <div class="avatar">AD</div>
                        <span class="username">Admin</span>
                        <i data-lucide="chevron-down"></i>
                        <div id="profile-menu" class="profile-dropdown">
                            <button onclick="switchTab('settings', this); toggleProfileMenu();">
                                <i data-lucide="settings" style="width:16px"></i>
                                Sozlamalar
                            </button>
                            <button onclick="logout()">
                                <i data-lucide="log-out" style="width:16px"></i>
                                Chiqish
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- DASHBOARD VIEW -->
            <div id="view-dashboard" class="content-view">
                <div class="dashboard-grid">
                    <!-- Main Dashboard Area -->
                    <div class="dashboard-main">
                        <section class="overview-section">
                            <h3>Umumiy ko‘rsatkichlar</h3>
                            <div class="stats-grid">
                                <div class="stat-card" style="--card-color: #3B82F6; --card-bg: #EBF5FF;">
                                    <div class="stat-icon-wrapper">
                                        <i data-lucide="wallet"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value-container">
                                            <span class="stat-value" id="dash-balance">********* so'm</span>
                                            <button class="privacy-toggle" onclick="toggleBalancePrivacy()"
                                                title="Yashirish/Ko'rsatish">
                                                <i data-lucide="eye-off" id="balance-eye-icon"></i>
                                            </button>
                                        </div>
                                        <span class="stat-label">Joriy Qoldiq</span>
                                    </div>
                                </div>
                                <div class="stat-card" style="--card-color: #F4B846; --card-bg: #FDEDC9;">
                                    <div class="stat-icon-wrapper">
                                        <i data-lucide="trending-up"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="dash-efficiency">0%</span>
                                        <span class="stat-label">Samaradorlik</span>
                                    </div>
                                </div>
                                <div class="stat-card dark"
                                    style="--card-color: #fff; --card-bg: linear-gradient(135deg, #9D50FF 0%, #3CC7F5 100%);">
                                    <div class="stat-icon-wrapper">
                                        <i data-lucide="check-circle"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="dash-task-count">0</span>
                                        <span class="stat-label">Bajarilgan vazifalar</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Bugungi Fokus Section -->
                        <section class="focus-section" id="focus-block" style="display: none;">
                            <div class="focus-card">
                                <div class="focus-icon-box">
                                    <i data-lucide="flame"></i>
                                </div>
                                <div class="focus-content">
                                    <h4 class="focus-title">Bugungi Fokus 🔥</h4>
                                    <div class="focus-details">
                                        <span id="focus-today-count">Bugun 0 ta vazifa rejalangan</span>
                                        <span class="focus-dot">•</span>
                                        <span id="focus-overdue-count" class="focus-highlight">0 tasi kechikkan</span>
                                        <span class="focus-dot">•</span>
                                        <span id="focus-next-time" class="focus-dim">Keyingi reja: Noma'lum</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="dashboard-tasks">
                            <div class="section-header">
                                <h3>Bajarilayotgan vazifalar</h3>
                                <a href="#"
                                    onclick="switchTab('tasks', document.querySelector('[onclick*=\'tasks\']'))">Hammasini
                                    ko'rish</a>
                            </div>
                            <div id="dash-ongoing-tasks" class="dash-task-list">
                                <!-- Active tasks will be here -->
                            </div>
                        </section>
                    </div>

                    <!-- Dashboard Sidebar Area -->
                    <div class="dashboard-sidebar">
                        <div class="mini-calendar-card">
                            <div class="mini-cal-header">
                                <button class="icon-btn" onclick="changeMiniCalMonth(-1)"><i
                                        data-lucide="chevron-left"></i></button>
                                <h4 id="mini-cal-month">Fevral 2026</h4>
                                <button class="icon-btn" onclick="changeMiniCalMonth(1)"><i
                                        data-lucide="chevron-right"></i></button>
                            </div>
                            <div class="mini-cal-days">
                                <span>Du</span><span>Se</span><span>Ch</span><span>Pa</span><span>Ju</span><span>Sh</span><span>Ya</span>
                            </div>
                            <div id="mini-cal-grid" class="mini-cal-grid">
                                <!-- Days will be generated -->
                            </div>
                        </div>

                        <div class="quick-stats-card">
                            <h4 id="quick-stats-header">Bugungi Rejalar</h4>
                            <div id="dash-today-events" class="dash-events-list">
                                <!-- Today's events -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TASKS VIEW -->
            <div id="view-tasks" class="content-view" style="display: none;">
                <div class="kanban-wrapper">
                    <div class="kanban-controls">
                        <h2>Vazifalar Doskasi</h2>
                        <button class="primary-btn" onclick="openTaskModal()">
                            <i data-lucide="plus"></i> Yangi Vazifa
                        </button>
                    </div>

                    <!-- Modal for Adding Task -->
                    <div id="task-modal" class="modal-overlay" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="task-modal-title">Yangi Vazifa Qo'shish</h3>
                                <button class="close-btn" onclick="closeTaskModal()"><i data-lucide="x"></i></button>
                            </div>
                            <div class="modal-body">
                                <label>Vazifa Nomi</label>
                                <input type="text" id="k-title" placeholder="Masalan: Web sahifa dizayni"
                                    class="modal-input">

                                <label>Izoh</label>
                                <textarea id="k-desc" placeholder="Qisqacha izoh..." class="modal-input"></textarea>

                                <div class="modal-row">
                                    <div class="field-group">
                                        <label>Muddati</label>
                                        <input type="date" id="k-deadline" class="modal-input">
                                    </div>
                                </div>

                                <input type="hidden" id="edit-task-id">
                                <button onclick="addKanbanTask()" class="modal-submit-btn">Saqlash</button>
                            </div>
                        </div>
                    </div>

                    <!-- Kanban Board -->
                    <div class="kanban-board">
                        <!-- Column 1: Boshlanmagan (Red) -->
                        <div class="kanban-column" id="col-todo" ondrop="drop(event, 'todo')"
                            ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                            <div class="column-header header-red">
                                <div class="header-title">
                                    <span class="dot red"></span>
                                    <h3>Boshlanmagan</h3>
                                </div>
                                <span class="count-badge" id="count-todo">0</span>
                            </div>
                            <div class="task-list-container" id="list-todo">
                                <!-- Tasks injected here -->
                            </div>
                        </div>

                        <!-- Column 2: Jarayonda (Yellow) -->
                        <div class="kanban-column" id="col-in-progress" ondrop="drop(event, 'in-progress')"
                            ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                            <div class="column-header header-yellow">
                                <div class="header-title">
                                    <span class="dot yellow"></span>
                                    <h3>Jarayonda</h3>
                                </div>
                                <span class="count-badge" id="count-in-progress">0</span>
                            </div>
                            <div class="task-list-container" id="list-in-progress">
                                <!-- Tasks injected here -->
                            </div>
                        </div>

                        <!-- Column 3: Yakunlangan (Green) -->
                        <div class="kanban-column" id="col-done" ondrop="drop(event, 'done')"
                            ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                            <div class="column-header header-green">
                                <div class="header-title">
                                    <span class="dot green"></span>
                                    <h3>Yakunlangan</h3>
                                </div>
                                <span class="count-badge" id="count-done">0</span>
                            </div>
                            <div class="task-list-container" id="list-done">
                                <!-- Tasks injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CALENDAR VIEW -->
            <div id="view-calendar" class="content-view" style="display: none;">
                <div class="calendar-page-layout">
                    <!-- Left: Control & Grid -->
                    <div class="calendar-content-left">
                        <div class="calendar-header-v3">
                            <div class="header-v3-left">
                                <div class="header-v3-label-group">
                                    <h2 id="current-period-label">Fevral 2026</h2>
                                    <div class="cal-nav-arrows">
                                        <button class="cal-nav-btn" onclick="changeCalendarDate(-1)">
                                            <i data-lucide="chevron-left"></i>
                                        </button>
                                        <button class="cal-nav-btn" onclick="changeCalendarDate(1)">
                                            <i data-lucide="chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                                <button class="cal-today-btn" onclick="goToToday()">Bugun</button>
                            </div>
                            <div class="header-v3-right">
                                <div class="cal-view-toggle">
                                    <button id="cal-view-week" class="cal-toggle-btn"
                                        onclick="setCalendarView('week', this)">Haftalik</button>
                                    <button id="cal-view-month" class="cal-toggle-btn active"
                                        onclick="setCalendarView('month', this)">Oylik</button>
                                    <button id="cal-view-year" class="cal-toggle-btn"
                                        onclick="setCalendarView('year', this)">Yillik</button>
                                </div>
                                <button class="primary-btn-modern" onclick="openEventModal()">
                                    <i data-lucide="plus"></i> Reja qo'shish
                                </button>
                            </div>
                        </div>

                        <div id="calendar-grid-v3" class="calendar-grid-v3 month-view">
                            <!-- JS will inject days here -->
                        </div>
                    </div>

                    <!-- Right: Info Panel -->
                    <div class="calendar-info-right" id="event-details-panel">
                        <div class="no-selection-state">
                            <div class="illus-circle">
                                <i data-lucide="calendar-days"></i>
                            </div>
                            <h3>Reja tanlanmagan</h3>
                            <p>Tafsilotlarni ko'rish uchun kalendardagi rejalardan birini tanlang yoki yangi reja
                                qo'shing.</p>
                        </div>
                    </div>
                </div>
            </div> <!-- Event Modal -->
            <div id="event-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="event-modal-title">Yangi Reja Qo'shish</h3>
                        <button class="close-btn" onclick="closeEventModal()"><i data-lucide="x"></i></button>
                    </div>
                    <div class="modal-body">
                        <label>Reja Nomi</label>
                        <input type="text" id="e-title" placeholder="Uchrashuv, Majlis..." class="modal-input">

                        <label>Tafsilotlar (Izoh)</label>
                        <textarea id="e-desc" placeholder="Reja haqida to'liqroq ma'lumot..." class="modal-input"
                            style="height: 80px;"></textarea>

                        <div class="modal-row">
                            <div class="field-group">
                                <label>Sana</label>
                                <input type="date" id="e-date" class="modal-input">
                            </div>
                            <div class="field-group">
                                <label>Vaqt</label>
                                <input type="time" id="e-time" class="modal-input">
                            </div>
                        </div>

                        <label>Rang</label>
                        <div class="color-options">
                            <span class="color-option selected" style="background:#6B4EFF"
                                onclick="selectColor(this, '#6B4EFF')"></span>
                            <span class="color-option" style="background:#EF5C91"
                                onclick="selectColor(this, '#EF5C91')"></span>
                            <span class="color-option" style="background:#FFA654"
                                onclick="selectColor(this, '#FFA654')"></span>
                            <span class="color-option" style="background:#4ADB97"
                                onclick="selectColor(this, '#4ADB97')"></span>
                            <span class="color-option" style="background:#3B82F6"
                                onclick="selectColor(this, '#3B82F6')"></span>
                        </div>
                        <input type="hidden" id="e-color" value="#6B4EFF">

                        <div class="modal-footer-btns"
                            style="display: flex; gap: 10px; margin-top: 1rem; justify-content: flex-end;">
                            <button id="delete-event-btn" onclick="deleteCurrentEvent()" class="danger-btn"
                                style="display: none; padding: 12px 20px;">
                                <i data-lucide="trash-2"></i>
                            </button>
                            <button onclick="addEvent()" class="modal-submit-btn"
                                style="margin-top: 0;">Saqlash</button>
                        </div>
                    </div>
                </div>
            </div>


            <div id="view-finance" class="content-view" style="display: none;">
                <!-- Finance Summary Header -->
                <div class="finance-summary">
                    <div class="summary-card income">
                        <div class="card-icon"><i data-lucide="arrow-down-circle"></i></div>
                        <div class="card-info">
                            <span class="label">Jami Kirim</span>
                            <h3 id="total-income">0 so'm</h3>
                        </div>
                    </div>
                    <div class="summary-card expense">
                        <div class="card-icon"><i data-lucide="arrow-up-circle"></i></div>
                        <div class="card-info">
                            <span class="label">Jami Chiqim</span>
                            <h3 id="total-expense">0 so'm</h3>
                        </div>
                    </div>
                    <div class="summary-card balance">
                        <div class="card-icon"><i data-lucide="wallet"></i></div>
                        <div class="card-info">
                            <span class="label">Joriy Qoldiq</span>
                            <h3 id="total-balance">0 so'm</h3>
                        </div>
                    </div>
                </div>

                <!-- Finance Inputs -->
                <div class="finance-actions">
                    <!-- Income Form -->
                    <div class="finance-form-box">
                        <h4>Kirim Qo'shish</h4>
                        <div class="form-group">
                            <label>Summa</label>
                            <input type="number" id="income-amount" placeholder="0" class="modal-input">
                        </div>
                        <div class="form-group">
                            <label>Turi</label>
                            <select id="income-type" class="modal-select">
                                <option value="salary">Oylik</option>
                                <option value="extra">Qo'shimcha</option>
                            </select>
                        </div>
                        <button class="primary-btn full-width" onclick="addTransaction('income')">Qo'shish</button>
                    </div>

                    <!-- Expense Form -->
                    <div class="finance-form-box">
                        <h4>Chiqim Qo'shish</h4>
                        <div class="form-group">
                            <label>Summa</label>
                            <input type="number" id="expense-amount" placeholder="0" class="modal-input">
                        </div>
                        <div class="form-group">
                            <label>Izoh</label>
                            <input type="text" id="expense-desc" placeholder="Nima uchun?" class="modal-input">
                        </div>
                        <button class="danger-btn full-width" onclick="addTransaction('expense')">Chiqarish</button>
                    </div>
                </div>

                <!-- Transaction History -->
                <!-- Transaction History -->
                <div class="transaction-history" id="finance-history-section">
                    <div class="history-header">
                        <h3>Tarix</h3>
                        <div class="history-controls">
                            <div class="view-toggle">
                                <button class="toggle-btn" id="view-daily"
                                    onclick="setFinanceView('daily')">Kunlik</button>
                                <button class="toggle-btn" id="view-weekly"
                                    onclick="setFinanceView('weekly')">Haftalik</button>
                                <button class="toggle-btn active" id="view-monthly"
                                    onclick="setFinanceView('monthly')">Oylik</button>
                            </div>
                            <button class="icon-btn download-btn" onclick="downloadFinancePDF()"
                                title="PDF Yuklab olish">
                                <i data-lucide="download"></i>
                            </button>
                            <button class="icon-btn delete-all-btn" onclick="clearCurrentPeriodFinance()"
                                title="Ushbu davrni tozalash" style="color: var(--text-muted); margin-left: 5px;">
                                <i data-lucide="trash-2"></i>
                            </button>
                            <!-- Restore (Undo) History -->
                            <div class="action-wrapper" style="margin-left: 5px;">
                                <button class="icon-btn restore-history-btn" onclick="toggleRestoreDropdown()"
                                    title="O'chirilganlarni tiklash">
                                    <i data-lucide="rotate-ccw"></i>
                                    <span id="restore-badge" class="badge-count" style="display: none;">0</span>
                                </button>
                                <div id="restore-dropdown" class="action-dropdown restore-dropdown">
                                    <div class="dropdown-header">
                                        <span>O'chirilganlar (Oxirgi 3 ta)</span>
                                    </div>
                                    <div id="restore-history-list" class="dropdown-list">
                                        <!-- Trash operations injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="finance-date-nav">
                        <button class="icon-btn" onclick="changeFinanceDate(-1)"><i
                                data-lucide="chevron-left"></i></button>
                        <span id="finance-date-label" class="date-label">Bugun</span>
                        <button class="icon-btn" onclick="changeFinanceDate(1)"><i
                                data-lucide="chevron-right"></i></button>
                    </div>

                    <div class="history-list" id="transaction-list">
                        <!-- Items will be here -->
                    </div>
                </div>
            </div>

            <!-- NOTES VIEW -->
            <div id="view-notes" class="content-view" style="display: none;">
                <div class="notes-container">
                    <div class="notes-sidebar">
                        <div class="notes-sidebar-header">
                            <h3>Mening Qaydlarim</h3>
                            <button class="icon-btn" onclick="createNewNote()" title="Yangi qayd">
                                <i data-lucide="plus-circle"></i>
                            </button>
                        </div>
                        <div id="notes-list" class="notes-list">
                            <!-- Saved notes will appear here -->
                        </div>
                    </div>
                    <div class="notes-editor" id="note-editor-container">
                        <div class="editor-header">
                            <button class="mobile-back-btn" onclick="showNotesList()">
                                <i data-lucide="arrow-left"></i> Orqaga
                            </button>
                            <div class="editor-actions">
                                <span id="note-status"
                                    style="font-size: 0.8rem; color: #888; margin-right: 10px;"></span>
                                <div class="dropdown">
                                    <button class="secondary-btn dropdown-toggle">
                                        <i data-lucide="download"></i> <span class="hide-mobile">Yuklab olish</span>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a href="#" onclick="downloadNotePDF()">PDF formatida</a>
                                        <a href="#" onclick="downloadNoteWord()">Word formatida</a>
                                    </div>
                                </div>
                                <button class="danger-btn icon-only" onclick="deleteCurrentNote()" title="O'chirish">
                                    <i data-lucide="trash-2"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-toolbar">
                            <button type="button" onclick="insertHorizontalLine()" title="Chiziq qo'shish"><i
                                    data-lucide="minus"></i></button>
                        </div>
                        <input type="text" id="note-title" class="note-title-input" placeholder="Sarlavha yozing...">
                        <textarea id="note-content" class="note-content-area"
                            placeholder="Matnni shu yerga yozing..."></textarea>
                    </div>
                </div>
            </div>

            <!-- SETTINGS VIEW -->
            <div id="view-settings" class="content-view" style="display: none;">
                <div class="settings-container">
                    <!-- Settings Sidebar -->
                    <div class="settings-sidebar">
                        <div class="settings-user-info">
                            <div class="settings-avatar-wrapper">
                                <img id="settings-avatar-img" src="assets/default-avatar.png" alt="Avatar"
                                    class="settings-avatar">
                                <label for="avatar-upload" class="avatar-edit-icon" title="Rasm yuklash">
                                    <i data-lucide="camera"></i>
                                </label>
                                <input type="file" id="avatar-upload" accept="image/*" style="display: none;"
                                    onchange="handleAvatarUpload(event)">
                            </div>
                            <h3 id="settings-user-fullname">Ism Familiya</h3>
                            <p id="settings-user-role">Foydalanuvchi</p>
                        </div>
                        <nav class="settings-nav">
                            <a href="#" id="set-nav-personal" class="settings-nav-item active"
                                onclick="showSettingsTab('personal')">
                                <i data-lucide="user"></i>
                                <span>Shaxsiy ma'lumotlar</span>
                            </a>
                            <a href="#" id="set-nav-security" class="settings-nav-item"
                                onclick="showSettingsTab('security')">
                                <i data-lucide="lock"></i>
                                <span>Xavfsizlik</span>
                            </a>
                            <a href="#" class="settings-nav-item danger" onclick="logout()">
                                <i data-lucide="log-out"></i>
                                <span>Chiqish</span>
                            </a>
                        </nav>
                    </div>

                    <!-- Settings Content -->
                    <div class="settings-content-card">
                        <!-- Personal Info Tab -->
                        <div id="settings-tab-personal" class="settings-tab-content">
                            <div class="settings-header">
                                <h2>Shaxsiy ma'lumotlar</h2>
                                <p>Ma'lumotlaringizni shu yerda boshqarishingiz mumkin.</p>
                            </div>
                            <div class="settings-form">
                                <div class="form-row">
                                    <div class="form-group-settings">
                                        <label>Ism Familiya</label>
                                        <input type="text" id="s-fullname" class="settings-input"
                                            placeholder="Ismingizni kiriting">
                                    </div>
                                    <div class="form-group-settings">
                                        <label>Login (Username)</label>
                                        <input type="text" id="s-login" class="settings-input" disabled
                                            title="Loginni o'zgartirib bo'lmaydi">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group-settings" style="flex: 1;">
                                        <label>Gmail manzilingiz</label>
                                        <div class="input-with-icon-wrapper">
                                            <input type="email" id="s-email" class="settings-input"
                                                placeholder="example@gmail.com">
                                            <span class="verified-badge"><i data-lucide="check-circle"></i>
                                                Tasdiqlangan</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group-settings">
                                        <label>Telefon raqam</label>
                                        <input type="tel" id="s-phone" class="settings-input"
                                            placeholder="+998 90 123 45 67">
                                    </div>
                                    <div class="form-group-settings">
                                        <label>Manzil (Ixtiyoriy)</label>
                                        <input type="text" id="s-location" class="settings-input"
                                            placeholder="Toshkent, O'zbekiston">
                                    </div>
                                </div>
                                <div class="settings-footer">
                                    <button class="secondary-btn"
                                        onclick="switchTab('dashboard', document.querySelector('.nav-item'))">Bekor
                                        qilish</button>
                                    <button class="primary-btn" onclick="saveUserSettings()">O'zgarishlarni
                                        saqlash</button>
                                </div>
                            </div>
                        </div>

                        <!-- Security Tab -->
                        <div id="settings-tab-security" class="settings-tab-content" style="display: none;">
                            <div class="settings-header">
                                <h2>Xavfsizlik</h2>
                                <p>Akkountingiz xavfsizligini ta'minlash uchun parolni yangilang.</p>
                            </div>
                            <div class="settings-form">
                                <div class="form-group-settings">
                                    <label>Joriy parol</label>
                                    <input type="password" id="s-current-password" class="settings-input"
                                        placeholder="Amaldagi parolni kiriting">
                                </div>
                                <div class="form-group-settings">
                                    <label>Yangi parol</label>
                                    <input type="password" id="s-new-password" class="settings-input"
                                        placeholder="Yangi parol o'ylab toping">
                                </div>
                                <div class="form-group-settings">
                                    <label>Yangi parolni tasdiqlang</label>
                                    <input type="password" id="s-confirm-password" class="settings-input"
                                        placeholder="Yangi parolni qayta kiriting">
                                </div>
                                <div class="settings-footer">
                                    <button class="primary-btn" onclick="updatePassword()">Parolni yangilash</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin View -->
            <div id="view-admin" class="content-view" style="display: none;">
                <div class="admin-card">
                    <div class="admin-header-flex">
                        <h2>Foydalanuvchilar Boshqaruvi</h2>
                        <div style="display: flex; gap: 10px; margin: 0 20px;">
                            <button class="primary-btn" onclick="openMessageModal()">
                                <i data-lucide="send"></i> Xabar Yuborish
                            </button>
                            <button class="secondary-btn" onclick="openBroadcastHistoryModal()"
                                style="border: 1px solid var(--primary); color: var(--primary);">
                                <i data-lucide="history"></i> Tarix
                            </button>
                        </div>
                        <div class="stats-group">
                            <div class="stat-badge">
                                <span style="color: var(--text-muted); font-size: 0.9rem;">Jami:</span>
                                <strong id="admin-total-users"
                                    style="font-size: 1.2rem; color: var(--primary); margin-left: 5px;">0</strong>
                            </div>
                            <div class="stat-badge">
                                <span style="color: var(--text-muted); font-size: 0.9rem;">Onlayn:</span>
                                <strong id="admin-online-users"
                                    style="font-size: 1.2rem; color: #4CAF50; margin-left: 5px;">0</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Message Modal -->
                    <div id="message-modal" class="modal-overlay" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Barchaga Xabar Yuborish</h3>
                                <button class="close-btn" onclick="closeMessageModal()"><i data-lucide="x"></i></button>
                            </div>
                            <div class="modal-body">
                                <label>Mavzu (Sarlavha)</label>
                                <input type="text" id="msg-title" placeholder="Masalan: Saytda texnik ishlar..."
                                    class="modal-input">

                                <label>Xabar matni</label>
                                <textarea id="msg-body" placeholder="Hurmatli foydalanuvchilar..." class="modal-input"
                                    style="height: 100px;"></textarea>

                                <label>Xabar turi</label>
                                <select id="msg-type" class="modal-select">
                                    <option value="info">Oddiy Xabar (Ko'k)</option>
                                    <option value="warning">Ogohlantirish (Sariq)</option>
                                    <option value="success">Tabriklash (Yashil)</option>
                                </select>

                                <button onclick="sendGlobalMessage()" class="modal-submit-btn">Yuborish 🚀</button>
                            </div>
                        </div>
                    </div>

                    <!-- Broadcast History Modal -->
                    <div id="broadcast-history-modal" class="modal-overlay" style="display: none;">
                        <div class="modal-content" style="max-width: 600px;">
                            <div class="modal-header">
                                <h3>Yuborilgan Xabarlar Tarixi</h3>
                                <button class="close-btn" onclick="closeBroadcastHistoryModal()"><i
                                        data-lucide="x"></i></button>
                            </div>
                            <div class="modal-body">
                                <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
                                    <button onclick="deleteAllBroadcastMessages()"
                                        style="font-size: 0.8rem; color: #E53E3E; background: #FFF5F5; border: 1px solid #FED7D7; padding: 6px 12px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                        <i data-lucide="trash-2" style="width: 14px;"></i> Barchasini o'chirish
                                    </button>
                                </div>

                                <div id="broadcast-history-list" class="admin-broadcasts-list"
                                    style="min-height: 300px;">
                                    <!-- History items -->
                                </div>

                                <div class="pagination-container" id="history-pagination"
                                    style="display: flex; justify-content: center; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                                    <!-- Pagination buttons -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users List Grid -->
                    <div class="admin-users-grid-container" style="margin-top: 25px;">
                        <div id="admin-users-list" class="admin-users-grid">
                            <!-- User cards will be injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Details Modal -->
            <div id="user-details-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content profile-detail-modal">
                    <div class="modal-header">
                        <h3 id="det-name">Foydalanuvchi Profili</h3>
                        <button class="close-btn" onclick="closeUserDetailsModal()"><i data-lucide="x"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="profile-header-main">
                            <div class="det-avatar" id="det-avatar">??</div>
                            <div class="det-main-info">
                                <h2 id="det-full-name">Noma'lum</h2>
                                <p id="det-status-badge" class="badge">Foydalanuvchi</p>
                            </div>
                        </div>

                        <div class="profile-info-grid">
                            <div class="info-group">
                                <label>Login</label>
                                <div class="info-value" id="det-login">-</div>
                            </div>
                            <div class="info-group">
                                <label>Parol</label>
                                <div class="info-value password-field" onclick="togglePasswordVisibility(this)">
                                    <span class="pass-stars">••••••••</span>
                                    <span class="pass-text" style="display: none;" id="det-pass">-</span>
                                    <i data-lucide="eye" class="eye-icon"></i>
                                </div>
                            </div>
                            <div class="info-group">
                                <label>Gmail</label>
                                <div class="info-value" id="det-email">-</div>
                            </div>
                            <div class="info-group">
                                <label>Telefon</label>
                                <div class="info-value" id="det-phone">-</div>
                            </div>
                            <div class="info-group" style="grid-column: span 2;">
                                <label>Lokatsiya</label>
                                <div class="info-value" id="det-location">-</div>
                            </div>
                            <div class="info-group" style="grid-column: span 2;">
                                <label>Oxirgi faollik</label>
                                <div class="info-value" id="det-last-seen">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- CUSTOM CONFIRM MODAL -->
    <div id="confirm-modal" class="modal-overlay" style="display: none; z-index: 2000;">
        <div class="confirm-content">
            <div class="confirm-icon-wrapper">
                <i data-lucide="trash-2" class="trash-icon"></i>
                <div class="icon-decoration">
                    <span>×</span><span>+</span><span>•</span><span>×</span>
                </div>
            </div>
            <h2 id="confirm-message">Rostdan ham o'chirmoqchimisiz?</h2>
            <div class="confirm-actions">
                <button id="confirm-yes-btn" class="delete-btn-large">Ha, O'chirish</button>
                <button id="confirm-no-btn" class="keep-btn">Bekor qilish</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, onValue, push, remove, update, onDisconnect, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2rC90acnHu8X0HAgZtZUBoHXrcXAbk6g",
            authDomain: "planora-d4b14.firebaseapp.com",
            projectId: "planora-d4b14",
            storageBucket: "planora-d4b14.firebasestorage.app",
            messagingSenderId: "651562345074",
            appId: "1:651562345074:web:87c5857cabf5f6bdaa18eb",
            measurementId: "G-G0S3K55N7X"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Export needed functions to window for script.js
        window.firebaseDB = db;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get; // Added
        window.firebaseChild = child; // Added
        window.push = push; // Added for compatibility
        window.firebaseOnValue = onValue;
        window.firebaseOnDisconnect = onDisconnect;
        window.firebaseRemove = remove;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseUpdate = update;
    </script>
    <script src="script.js?v=1.4"></script>
    <script>
        lucide.createIcons();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js');
            });
        }
    </script>
</body>

</html>